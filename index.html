<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Naruto: Crônicas do Ninja</title>
    <style>
        /* Importação da fonte do Google Fonts */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;700&display=swap');

        /* Estilos Globais */
        :root {
            --primary-bg: #1a1a1a;
            --secondary-bg: #2a2a2a;
            --text-color: #e0e0e0;
            --accent-color: #ff7f00;
            --border-color: #444;
            --modal-bg: rgba(0, 0, 0, 0.85);
            --gemini-glow: #00aaff;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--primary-bg);
            color: var(--text-color);
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 20px;
        }

        /* Contêiner Principal do Jogo */
        #game-container {
            width: 100%;
            max-width: 800px;
            height: 600px;
            background-color: var(--secondary-bg);
            border: 2px solid var(--border-color);
            border-radius: 15px;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.5);
            overflow: hidden;
            position: relative;
            display: flex;
            flex-direction: column;
        }

        /* Estilo das Telas (Menus, Jogo, etc.) */
        .screen {
            padding: 40px;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            transition: opacity 0.5s ease-in-out;
        }

        .hidden { display: none; }
        
        h1, h2 {
            color: var(--accent-color);
            margin-bottom: 20px;
        }

        p {
            line-height: 1.6;
            margin-bottom: 15px;
        }

        /* Estilo dos Botões */
        .btn {
            background-color: var(--accent-color);
            color: #111;
            border: none;
            padding: 12px 25px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            margin: 10px;
            transition: transform 0.2s, background-color 0.2s;
            min-width: 200px;
        }

        .btn:hover {
            background-color: #ff9933;
            transform: scale(1.05);
        }
        
        /* Botão Gemini */
        .gemini-btn {
            background-color: var(--gemini-glow);
            color: white;
            box-shadow: 0 0 10px var(--gemini-glow);
        }
        .gemini-btn:hover {
            background-color: #33bbff;
        }
        
        .input-field {
            padding: 10px;
            border-radius: 5px;
            border: 1px solid var(--border-color);
            background-color: var(--primary-bg);
            color: var(--text-color);
            font-size: 16px;
            margin-top: 10px;
            width: 80%;
            max-width: 300px;
        }

        /* Barra de Status */
        #status-bar {
            width: 100%;
            background-color: rgba(0,0,0,0.6);
            padding: 10px 20px;
            display: flex;
            justify-content: space-between;
            font-size: 14px;
            border-bottom: 1px solid var(--border-color);
        }

        /* Tela do Jogo Principal */
        #game-screen {
            padding: 0;
            justify-content: flex-start;
            background-size: cover;
            background-position: center;
        }

        #game-content {
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: flex-end;
            padding: 20px;
        }

        #story-container {
            background-color: rgba(0, 0, 0, 0.75);
            padding: 20px;
            border-radius: 10px;
            border-top: 2px solid var(--accent-color);
            width: 100%;
        }
        
        #story-text {
            height: 150px;
            overflow-y: auto;
            margin-bottom: 20px;
            text-align: left;
        }
        
        #choices-container {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
        }
        
        .choice-btn {
            min-width: 150px;
            padding: 10px 20px;
            margin: 5px;
        }

        #action-buttons {
            position: absolute;
            top: 60px;
            right: 20px;
            display: flex;
            flex-direction: column;
        }

        .action-btn {
            background-color: var(--secondary-bg);
            color: var(--accent-color);
            border: 1px solid var(--accent-color);
            width: 120px;
            margin-bottom: 10px;
        }

        .modal {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: var(--modal-bg);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 200;
        }

        .modal-content {
            background-color: var(--secondary-bg);
            padding: 30px;
            border-radius: 10px;
            border: 1px solid var(--border-color);
            width: 90%;
            max-width: 500px;
            text-align: center;
        }

        .modal-content ul {
            list-style: none;
            padding: 0;
            margin-bottom: 20px;
            max-height: 200px;
            overflow-y: auto;
        }

        .modal-content li {
            padding: 8px;
            border-bottom: 1px solid var(--border-color);
        }

        #event-notification {
            position: absolute;
            top: -100px;
            left: 50%;
            transform: translateX(-50%);
            background-color: var(--accent-color);
            color: var(--primary-bg);
            padding: 15px 30px;
            border-radius: 0 0 10px 10px;
            font-weight: bold;
            box-shadow: 0 5px 15px rgba(0,0,0,0.4);
            transition: top 0.5s ease-in-out;
            z-index: 100;
        }

        #event-notification.show { top: 0; }

    </style>
</head>
<body>

    <div id="game-container">
        <!-- Notificação de Evento -->
        <div id="event-notification"></div>

        <!-- Telas Iniciais -->
        <div id="main-menu-screen" class="screen">
            <h1>Naruto: Crônicas do Ninja</h1>
            <button id="new-game-btn" class="btn">Novo Jogo</button>
            <button id="load-game-btn" class="btn" disabled>Carregar Jogo</button>
        </div>
        
        <div id="difficulty-screen" class="screen hidden">
            <h2>Escolha a Dificuldade</h2>
            <button class="btn difficulty-btn" data-difficulty="Genin">Genin (Fácil)</button>
            <button class="btn difficulty-btn" data-difficulty="Chunin">Chunin (Normal)</button>
            <button class="btn difficulty-btn" data-difficulty="Jonin">Jonin (Difícil)</button>
        </div>

        <div id="character-creation-screen" class="screen hidden">
            <h2>Criação de Personagem</h2>
            <p>Qual é o seu nome?</p>
            <input type="text" id="player-name-input" class="input-field" placeholder="Digite seu nome...">
            <p style="margin-top: 20px;">Qual é o seu clã?</p>
            <select id="clan-select" class="input-field">
                <option value="Uchiha">Uchiha</option>
                <option value="Hyuga">Hyuga</option>
            </select>
            <button id="create-character-btn" class="btn" style="margin-top: 30px;">Iniciar Jornada</button>
        </div>

        <!-- Tela Principal do Jogo -->
        <div id="game-screen" class="screen hidden">
            <div id="status-bar">
                <div id="location-status">Local: ???</div>
                <div id="time-status">Período: ???</div>
            </div>

            <div id="action-buttons">
                <button id="inventory-btn" class="btn action-btn">Inventário</button>
                <button id="jutsu-btn" class="btn action-btn">Jutsus</button>
            </div>

            <div id="game-content">
                 <div id="story-container">
                    <div id="story-text"></div>
                    <div id="choices-container"></div>
                </div>
            </div>
        </div>

        <!-- Modals -->
        <div id="inventory-modal" class="modal hidden">
            <div class="modal-content">
                <h2>Inventário</h2>
                <ul id="inventory-list"></ul>
                <button id="close-inventory-btn" class="btn">Fechar</button>
            </div>
        </div>
        <div id="jutsu-modal" class="modal hidden">
            <div class="modal-content">
                <h2>Jutsus Conhecidos</h2>
                <ul id="jutsu-list"></ul>
                <button id="close-jutsu-btn" class="btn">Fechar</button>
            </div>
        </div>
        <div id="training-modal" class="modal hidden">
            <div class="modal-content">
                <h2>Quanto tempo você quer treinar?</h2>
                <button class="btn training-option-btn" data-duration="1">1 Hora (Leve)</button>
                <button class="btn training-option-btn" data-duration="4">4 Horas (Intenso)</button>
                <button class="btn training-option-btn" data-duration="8">8 Horas (Exaustivo)</button>
                <button id="cancel-training-btn" class="btn" style="background-color: #888;">Cancelar</button>
            </div>
        </div>

    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {

            // ===================================
            //  CLASSES E ESTRUTURAS DE DADOS
            // ===================================
            class Jutsu {
                constructor(name, description, power, chakraCost) {
                    this.name = name;
                    this.description = description;
                    this.power = power;
                    this.chakraCost = chakraCost;
                }
            }
            
            class Clan {
                constructor(name, description, homeVillage) {
                    this.name = name;
                    this.description = description;
                    this.homeVillage = homeVillage;
                    if (this.constructor === Clan) {
                        throw new Error("A classe base 'Clan' não pode ser instanciada.");
                    }
                }
                checkForNarrativeProgression(character, storyEvent) {
                    throw new Error("O método 'checkForNarrativeProgression' deve ser implementado pela subclasse.");
                }
            }

            class UchihaClan extends Clan {
                constructor() {
                    super("Uchiha", "Conhecidos por seu poderoso dojutsu, o Sharingan.", "Konohagakure");
                    this.sharinganState = 'Inactive';
                    this.sharinganLevels = ['Inactive', 'OneTomoe', 'TwoTomoe', 'ThreeTomoe', 'Mangekyo'];
                }
                checkForNarrativeProgression(character, storyEvent) {
                    if (storyEvent.eventType === "Trauma" && storyEvent.intensity > 5) {
                        const currentStateIndex = this.sharinganLevels.indexOf(this.sharinganState);
                        if (currentStateIndex < this.sharinganLevels.indexOf('ThreeTomoe')) {
                            this.sharinganState = this.sharinganLevels[currentStateIndex + 1];
                            const message = currentStateIndex === 0 
                                ? `Em meio à dor, ${character.name} despertou o Sharingan!`
                                : `O trauma fortaleceu o dojutsu de ${character.name}. Seu Sharingan evoluiu!`;
                            gameManager.showNotification(message);
                        }
                    }
                }
            }

            class HyugaClan extends Clan {
                constructor() {
                    super("Hyuga", "Possuidores do Byakugan.", "Konohagakure");
                    this.proficiency = 'Untrained';
                    this.proficiencyLevels = ['Untrained', 'Basic', 'Adept', 'Master'];
                }
                checkForNarrativeProgression(character, storyEvent) {
                    if (storyEvent.eventType === "IntenseTraining") {
                        if(character.storyFlags["trained_today"]) return;

                        const currentProficiencyIndex = this.proficiencyLevels.indexOf(this.proficiency);
                        if (currentProficiencyIndex < this.proficiencyLevels.length - 1 && storyEvent.intensity >= 8) {
                            this.proficiency = this.proficiencyLevels[currentProficiencyIndex + 1];
                            gameManager.showNotification(`Sua proficiência com o Byakugan aumentou para ${this.proficiency}!`);
                            character.learnJutsu(new Jutsu("Oito Trigramas: Palma de Vácuo", "Uma rajada de vácuo de alta pressão.", 60, 30));
                            character.storyFlags["trained_today"] = true;
                        }
                    }
                }
            }

            class Player {
                constructor() {
                    this.name = "";
                    this.playerClan = null;
                    this.homeVillage = "Konohagakure";
                    this.knownJutsus = [];
                    this.inventory = [{ name: 'Kunai', quantity: 5 }, { name: 'Shuriken', quantity: 10 }];
                    this.storyFlags = {};
                }
                learnJutsu(newJutsu) {
                    if (!this.knownJutsus.some(j => j.name === newJutsu.name)) {
                        this.knownJutsus.push(newJutsu);
                        gameManager.showNotification(`${this.name} aprendeu um novo jutsu: ${newJutsu.name}!`);
                    }
                }
            }
            
            class NPC {
                constructor(name, dialogueCallback) {
                    this.name = name;
                    this.dialogueCallback = dialogueCallback;
                }
                interact() {
                    this.dialogueCallback();
                }
            }

            class StoryEvent {
                 constructor(eventType, intensity) {
                    this.eventType = eventType;
                    this.intensity = intensity;
                }
            }

            // ===================================
            //  GERENCIADOR DO JOGO (GAME MANAGER)
            // ===================================

            const gameManager = {
                player: null,
                difficulty: null,
                timePeriods: ['Manhã', 'Tarde', 'Noite', 'Madrugada'],
                currentTimeIndex: 0,
                currentLocation: 'Apartamento',
                npcs: {},

                ui: {
                    mainMenuScreen: document.getElementById('main-menu-screen'),
                    difficultyScreen: document.getElementById('difficulty-screen'),
                    characterCreationScreen: document.getElementById('character-creation-screen'),
                    gameScreen: document.getElementById('game-screen'),
                    storyText: document.getElementById('story-text'),
                    choicesContainer: document.getElementById('choices-container'),
                    notification: document.getElementById('event-notification'),
                    inventoryModal: document.getElementById('inventory-modal'),
                    jutsuModal: document.getElementById('jutsu-modal'),
                    trainingModal: document.getElementById('training-modal'),
                    locationStatus: document.getElementById('location-status'),
                    timeStatus: document.getElementById('time-status'),
                },
                
                init() {
                    document.getElementById('new-game-btn').addEventListener('click', () => gameManager.showScreen('difficulty'));
                    document.querySelectorAll('.difficulty-btn').forEach(btn => {
                        btn.addEventListener('click', (e) => gameManager.selectDifficulty(e.target.dataset.difficulty));
                    });
                    document.getElementById('create-character-btn').addEventListener('click', () => gameManager.createCharacter());
                    document.getElementById('inventory-btn').addEventListener('click', () => gameManager.showInventory());
                    document.getElementById('jutsu-btn').addEventListener('click', () => gameManager.showJutsuList());
                    document.getElementById('close-inventory-btn').addEventListener('click', () => gameManager.ui.inventoryModal.classList.add('hidden'));
                    document.getElementById('close-jutsu-btn').addEventListener('click', () => gameManager.ui.jutsuModal.classList.add('hidden'));
                    document.getElementById('cancel-training-btn').addEventListener('click', () => gameManager.ui.trainingModal.classList.add('hidden'));
                    document.querySelectorAll('.training-option-btn').forEach(btn => {
                        btn.addEventListener('click', (e) => gameManager.startTraining(parseInt(e.target.dataset.duration)));
                    });
                },

                showScreen(screenName) {
                    Object.values(this.ui).forEach(screen => {
                        if (screen.classList && screen.classList.contains('screen')) {
                            screen.classList.add('hidden');
                        }
                    });
                    const screenToShow = this.ui[`${screenName}Screen`];
                    if(screenToShow) {
                        screenToShow.classList.remove('hidden');
                    }
                },
                
                selectDifficulty(difficulty) {
                    this.difficulty = difficulty;
                    this.showScreen('characterCreation');
                },

                createCharacter() {
                    const name = document.getElementById('player-name-input').value;
                    if (!name) { alert("Por favor, insira um nome."); return; }
                    this.player = new Player();
                    this.player.name = name;
                    const clanType = document.getElementById('clan-select').value;
                    this.player.playerClan = clanType === 'Uchiha' ? new UchihaClan() : new HyugaClan();
                    this.startGame();
                },

                startGame() {
                    this.setupNPCs();
                    this.showScreen('game');
                    this.updateLocation('Apartamento');
                },

                updateUI() {
                    this.ui.locationStatus.textContent = `Local: ${this.currentLocation}`;
                    this.ui.timeStatus.textContent = `Período: ${this.timePeriods[this.currentTimeIndex]}`;
                },

                updateStory(text, choices = []) {
                    this.ui.storyText.innerHTML = text;
                    this.ui.choicesContainer.innerHTML = '';
                    choices.forEach(choice => {
                        const button = document.createElement('button');
                        button.textContent = choice.text;
                        button.className = 'btn choice-btn';
                        if (choice.isGemini) {
                           button.classList.add('gemini-btn');
                        }
                        button.onclick = () => choice.action();
                        this.ui.choicesContainer.appendChild(button);
                    });
                },
                
                showNotification(message) {
                    this.ui.notification.textContent = message;
                    this.ui.notification.classList.add('show');
                    setTimeout(() => {
                        this.ui.notification.classList.remove('show');
                    }, 4000);
                },

                // --- MECÂNICAS GEMINI ---
                async callGemini(prompt, buttonToDisable) {
                    if(buttonToDisable) buttonToDisable.disabled = true;
                    this.ui.storyText.innerHTML += "<p><i>Gerando conteúdo com IA...</i></p>";

                    let chatHistory = [{ role: "user", parts: [{ text: prompt }] }];
                    const payload = { contents: chatHistory };
                    const apiKey = ""; // Chave de API é gerenciada pelo ambiente
                    const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;

                    try {
                        const response = await fetch(apiUrl, {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify(payload)
                        });
                        const result = await response.json();
                        if (result.candidates && result.candidates.length > 0) {
                            return result.candidates[0].content.parts[0].text;
                        } else {
                            return "A IA não conseguiu gerar uma resposta. Tente novamente.";
                        }
                    } catch (error) {
                        return "Erro ao conectar com a IA. Verifique sua conexão.";
                    } finally {
                         if(buttonToDisable) buttonToDisable.disabled = false;
                    }
                },

                async generateMission(event) {
                    const prompt = `Gere uma missão ninja de Rank D para um genin chamado ${this.player.name} do clã ${this.player.playerClan.name}. A missão deve ser simples, adequada para um novato, e ter um título, um cliente e uma descrição. Formate a resposta como: **Título:** [título] **Cliente:** [cliente] **Descrição:** [descrição]`;
                    const missionText = await this.callGemini(prompt, event.target);
                    this.updateStory(missionText.replace(/\*\*/g, '<b>').replace(/\n/g, '<br>'), [{ text: "Voltar", action: () => this.updateLocation(this.currentLocation) }]);
                },

                async getNpcAdvice(npcName, event) {
                    const prompt = `Aja como ${npcName} do universo de Naruto. Dê um conselho sábio e encorajador para um jovem genin chamado ${this.player.name}. O conselho deve ser curto, impactante e fiel ao personagem.`;
                    const adviceText = await this.callGemini(prompt, event.target);
                    const dialogue = `<p><b>${npcName}:</b> '${adviceText}'</p>`;
                    this.updateStory(dialogue, [{ text: "Agradecer", action: () => this.updateLocation(this.currentLocation) }]);
                },

                // --- MECÂNICAS DO JOGO ---

                advanceTime(periods = 1) {
                    this.currentTimeIndex = (this.currentTimeIndex + periods) % this.timePeriods.length;
                    if (this.currentTimeIndex === 0) {
                        this.showNotification("Um novo dia começa.");
                        this.player.storyFlags["trained_today"] = false;
                    }
                    this.updateLocation(this.currentLocation);
                },

                updateLocation(locationName) {
                    this.currentLocation = locationName;
                    this.updateUI();
                    
                    let text = "";
                    let choices = [];

                    switch(locationName) {
                        case 'Apartamento':
                            text = "<p>Você está em seu apartamento. Há um quadro de missões na parede.</p>";
                            choices.push({ text: "Gerar Missão ✨", isGemini: true, action: (e) => this.generateMission(e) });
                            choices.push({ text: "Ir para o Campo de Treinamento", action: () => this.updateLocation('Campo de Treinamento') });
                            choices.push({ text: "Dormir (Avançar para Manhã)", action: () => {
                                this.currentTimeIndex = -1;
                                this.advanceTime();
                            }});
                            break;
                        case 'Campo de Treinamento':
                            text = "<p>O campo de treinamento está quieto. O som do vento e dos pássaros é tudo que se ouve.</p>";
                            choices.push({ text: "Treinar", action: () => this.ui.trainingModal.classList.remove('hidden') });
                            
                            if (this.currentTimeIndex < 2) {
                                text += "<p>Iruka-sensei está observando alguns genins de longe.</p>";
                                choices.push({ text: "Falar com Iruka", action: () => this.npcs.iruka.interact() });
                            }

                            choices.push({ text: "Voltar para o Apartamento", action: () => this.updateLocation('Apartamento') });
                            break;
                    }

                    this.updateStory(text, choices);
                },

                startTraining(duration) {
                    this.ui.trainingModal.classList.add('hidden');
                    let intensity = duration * 2;
                    let text = `<p>Você treina por ${duration} hora(s).</p>`;

                    if (duration >= 4) text += "<p>O suor escorre pelo seu rosto, mas você sente seus músculos e seu chakra respondendo ao esforço.</p>";
                    if (duration >= 8) text += "<p>É um treino exaustivo que leva seu corpo ao limite da resistência.</p>";

                    const trainingEvent = new StoryEvent("IntenseTraining", intensity);
                    this.player.playerClan.checkForNarrativeProgression(this.player, trainingEvent);
                    
                    this.updateStory(text, [{ text: "Concluir Treino", action: () => this.advanceTime(Math.ceil(duration / 4)) }]);
                },
                
                setupNPCs() {
                    this.npcs.iruka = new NPC("Iruka", () => {
                        let dialogue = `<p><b>Iruka:</b> 'Olá, ${this.player.name}. O que deseja?'</p>`;
                        let choices = [
                            { text: "Pedir Conselho ✨", isGemini: true, action: (e) => this.getNpcAdvice("Iruka", e) },
                            { text: "Despedir-se", action: () => this.updateLocation(this.currentLocation) }
                        ];
                        this.updateStory(dialogue, choices);
                    });
                },

                showInventory() {
                    const list = this.ui.inventoryModal.querySelector('#inventory-list');
                    list.innerHTML = '';
                    this.player.inventory.forEach(item => {
                        const li = document.createElement('li');
                        li.textContent = `${item.name} (x${item.quantity})`;
                        list.appendChild(li);
                    });
                    this.ui.inventoryModal.classList.remove('hidden');
                },

                showJutsuList() {
                    const list = this.ui.jutsuModal.querySelector('#jutsu-list');
                    list.innerHTML = '';
                    if (this.player.knownJutsus.length === 0) {
                        list.innerHTML = "<li>Nenhum jutsu conhecido.</li>";
                    } else {
                        this.player.knownJutsus.forEach(jutsu => {
                            const li = document.createElement('li');
                            li.textContent = `${jutsu.name} - ${jutsu.description}`;
                            list.appendChild(li);
                        });
                    }
                    this.ui.jutsuModal.classList.remove('hidden');
                }
            };

            gameManager.init();
        });
    </script>

</body>
</html>
